{% extends "base.html" %}

{% block head %}
<!-- Load the documentation CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/other.css') }}">
{% endblock %}

{% block content %}
<div class="docs-layout">
    
    <!-- SIDEBAR -->
    <aside class="docs-sidebar">
        <h3>DELETE Guide</h3>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#syntax">Syntax</a></li>
            <li><a href="#basic-examples">Basic Examples</a></li>
            <li><a href="#where-clause">WHERE Clause</a></li>
            <li><a href="#complex">Complex Conditions</a></li>
            <li><a href="#null-checks">NULL Checks</a></li>
            <li><a href="#performance">Performance Notes</a></li>
            <li><a href="#safety">Safety Best Practices</a></li>
            <li><a href="#pitfalls">Common Pitfalls</a></li>
            <li><a href="#comparison">DML Comparison</a></li>
        </ul>

        <h3>Related Commands</h3>
        <ul>
            <li><a href="{{ url_for('main.select') }}">SELECT</a></li>
            <li><a href="{{ url_for('main.update') }}">UPDATE</a></li>
            <li><a href="{{ url_for('main.insert') }}">INSERT</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="docs-content">
        <h1>DELETE Command</h1>
        <p><strong>Data Manipulation Language (DML)</strong> ‚Äî Remove rows from a table based on conditions.</p>

        <section id="overview">
            <h2>Overview</h2>
            <p>The <code>DELETE</code> statement removes one or more rows from a table. A <code>WHERE</code> clause is used to specify which rows to delete. Without a <code>WHERE</code> clause, <strong>all rows in the table will be deleted</strong>.</p>
            <div class="warning-box">
                <strong>‚ö†Ô∏è Warning:</strong> Always use a <code>WHERE</code> clause unless you intentionally want to delete all rows. DELETE operations cannot be undone without a backup.
            </div>
        </section>

        <section id="syntax">
            <h2>Syntax</h2>
            <span class="code-label">Basic Syntax</span>
            <pre><code>DELETE FROM &lt;table_name&gt; WHERE &lt;condition&gt;;</code></pre>
            
            <div class="info-box">
                <strong>‚ÑπÔ∏è Note:</strong> The <code>WHERE</code> clause is required in production environments. Without it, all rows will be deleted.
            </div>
        </section>

        <section id="basic-examples">
            <h2>Basic Examples</h2>

            <h3>Delete a Single Row by ID</h3>
            <p>Using the primary key for fast lookup (O(1) operation):</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE id = 5;</code></pre>

            <h3>Delete by String Match</h3>
            <p>Remove rows where a text column matches a value:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE name = 'Charlie';</code></pre>

            <h3>Delete by Numeric Condition</h3>
            <p>Remove rows where a numeric column meets a condition:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE age < 18;</code></pre>

            <h3>Delete by Boolean Value</h3>
            <p>Remove inactive users:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE active = FALSE;</code></pre>
        </section>

        <section id="where-clause">
            <h2>WHERE Clause Details</h2>

            <h3>Comparison Operators</h3>
            <p>The WHERE clause supports standard comparison operators:</p>
            <ul>
                <li><code>=</code> Equal to</li>
                <li><code>&gt;</code> Greater than</li>
                <li><code>&lt;</code> Less than</li>
                <li><code>&gt;=</code> Greater than or equal</li>
                <li><code>&lt;=</code> Less than or equal</li>
            </ul>

            <span class="code-label">Examples</span>
            <pre><code>-- Delete rows where salary is above threshold
DELETE FROM employees WHERE salary > 100000;

-- Delete rows where age is less than cutoff
DELETE FROM users WHERE age < 21;

-- Delete exact match
DELETE FROM products WHERE price = 0.00;</code></pre>
        </section>

        <section id="complex">
            <h2>Complex WHERE Conditions</h2>

            <h3>AND Logic</h3>
            <p>Delete rows that match multiple conditions (all must be true):</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE age > 30 AND active = FALSE;</code></pre>

            <h3>OR Logic</h3>
            <p>Delete rows that match at least one condition:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE status = 'archived' OR age > 100;</code></pre>

            <h3>Combined AND/OR with Grouping</h3>
            <p>Use parentheses to control logical precedence:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM orders WHERE (status = 'cancelled' AND created_date < '2020-01-01') 
                   OR (total = 0 AND reason = 'test');</code></pre>

            <h3>NOT Operator</h3>
            <p>Delete rows that do NOT match a condition:</p>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE NOT (status = 'active');</code></pre>
        </section>

        <section id="null-checks">
            <h2>NULL Checks</h2>

            <h3>Delete Rows with NULL Values</h3>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE profile_picture IS NULL;</code></pre>

            <h3>Delete Rows WITHOUT NULL Values</h3>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE phone_number IS NOT NULL;</code></pre>

            <h3>Mixed NULL and Regular Conditions</h3>
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM orders WHERE (delivery_date IS NULL) AND (status = 'pending');</code></pre>
        </section>

        <section id="performance">
            <h2>Performance Notes</h2>

            <h3>Primary Key Lookups (O(1))</h3>
            <p>Deleting by primary key is extremely fast:</p>
            <span class="code-label">Fast</span>
            <pre><code>DELETE FROM users WHERE id = 123;</code></pre>

            <h3>Other Column Scans (O(n))</h3>
            <p>Deleting by non-indexed columns requires a full table scan:</p>
            <span class="code-label">Slower</span>
            <pre><code>DELETE FROM users WHERE email = 'user@example.com';</code></pre>

            <div class="info-box">
                <strong>üí° Tip:</strong> For large datasets, consider deleting in batches using LIMIT or filtering by date ranges to reduce lock times.
            </div>
        </section>

        <section id="safety">
            <h2>Safety Best Practices</h2>

            <h3>1. Always Test First with SELECT</h3>
            <p>Before running a DELETE, verify the rows with SELECT:</p>
            <span class="code-label">Safe Approach</span>
            <pre><code>-- First, verify what will be deleted
SELECT * FROM users WHERE age < 18;

-- Then, delete with confidence
DELETE FROM users WHERE age < 18;</code></pre>

            <h3>2. Create a Backup</h3>
            <p>Backup your database before bulk deletions:</p>
            <span class="code-label">Example</span>
            <pre><code>BACKUP 'before_deletion_2024';
DELETE FROM users WHERE status = 'deprecated';
-- Verify results, or restore if needed</code></pre>

            <h3>3. Use Transaction Limits</h3>
            <p>Delete in smaller batches for large datasets:</p>
            <span class="code-label">Example</span>
            <pre><code>-- Delete inactive users, but in manageable chunks
DELETE FROM users WHERE active = FALSE AND joined_date < '2020-01-01';</code></pre>

            <h3>4. Add Comments to Risky Operations</h3>
            <span class="code-label">Example</span>
            <pre><code>-- CAUTION: Removing all test records from production database
-- Created backup: 'prod_backup_2024_01_15'
DELETE FROM orders WHERE order_id IN (9001, 9002, 9003);</code></pre>
        </section>

        <section id="pitfalls">
            <h2>Common Pitfalls</h2>

            <h3>‚ùå Forgetting the WHERE Clause</h3>
            <p>This will delete <strong>every row in the table</strong>:</p>
            <span class="code-label">Dangerous</span>
            <pre><code>DELETE FROM users;  -- ALL users deleted!</code></pre>

            <h3>‚ùå Incorrect Column Names</h3>
            <p>Typos in column names will cause errors:</p>
            <span class="code-label">Error</span>
            <pre><code>DELETE FROM users WHERE username = 'alice';  -- Column 'username' doesn't exist</code></pre>

            <h3>‚ùå Type Mismatches</h3>
            <p>Comparing incompatible types may not match rows:</p>
            <span class="code-label">Error</span>
            <pre><code>DELETE FROM users WHERE id = '123';  -- id is INT, not TEXT</code></pre>

            <h3>‚ùå Complex Conditions Without Testing</h3>
            <p>Run SELECT first to verify the condition logic:</p>
            <span class="code-label">Safer</span>
            <pre><code>-- Test the condition
SELECT COUNT(*) FROM users WHERE (age > 50 AND status = 'inactive') OR premium = FALSE;

-- Then delete
DELETE FROM users WHERE (age > 50 AND status = 'inactive') OR premium = FALSE;</code></pre>
        </section>

        <section id="comparison">
            <h2>DELETE vs Other DML Commands</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Purpose</th>
                        <th>Can Undo?</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>INSERT</strong></td>
                        <td>Add new rows</td>
                        <td>Use DELETE</td>
                    </tr>
                    <tr>
                        <td><strong>SELECT</strong></td>
                        <td>Read rows (no change)</td>
                        <td>N/A</td>
                    </tr>
                    <tr>
                        <td><strong>UPDATE</strong></td>
                        <td>Modify existing rows</td>
                        <td>Use UPDATE again or RESTORE</td>
                    </tr>
                    <tr>
                        <td><strong>DELETE</strong></td>
                        <td>Remove rows</td>
                        <td>Use RESTORE backup</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Bottom Navigation -->
        <div style="display: flex; justify-content: space-between; margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border);">
            <a href="{{ url_for('main.update') }}" class="btn-nav" style="background: var(--bg-card); color: var(--text-main) !important; border: 1px solid var(--border); box-shadow: none;">&larr; Prev: UPDATE</a>
            <a href="{{ url_for('main.docs') }}" class="btn-nav">Back to Docs &rarr;</a>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
   <script src="{{ url_for('static', filename='js/docs.js') }}"></script>
{% endblock %}