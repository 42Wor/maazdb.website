{% extends "base.html" %}

{% block head %}
<!-- Load the documentation CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/other.css') }}">
{% endblock %}

{% block content %}
<div class="docs-layout">
    
    <!-- SIDEBAR -->
    <aside class="docs-sidebar">
        <h3>SELECT Guide</h3>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#syntax">Syntax</a></li>
            <li><a href="#basic-examples">Basic Examples</a></li>
            <li><a href="#filtering">Filtering (WHERE)</a></li>
            <li><a href="#sorting">Sorting & Pagination</a></li>
            <li><a href="#optimization">Performance (O(1))</a></li>
            <li><a href="#aggregates">Aggregates</a></li>
            <li><a href="#comparison">DML Comparison</a></li>
        </ul>

        <h3>Related Commands</h3>
        <ul>
            <li><a href="{{ url_for('main.insert') }}">INSERT</a></li>
            <li><a href="{{ url_for('main.update') }}">UPDATE</a></li>
            <li><a href="{{ url_for('main.delete') }}">DELETE</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="docs-content">
        <h1>SELECT Command</h1>
        <p><strong>Data Query Language (DQL)</strong> â€” Retrieve, filter, sort, and paginate data from tables.</p>

        <section id="overview">
            <h2>Overview</h2>
            <p>The <code>SELECT</code> statement is the primary way to read data from MaazDB. It supports complex filtering, sorting, and pagination. MaazDB includes a special optimization engine for Primary Key lookups.</p>
        </section>

        <section id="syntax">
            <h2>Syntax</h2>
            <span class="code-label">Basic Syntax</span>
            <pre><code>SELECT &lt;columns&gt; FROM &lt;table_name&gt;
[WHERE &lt;condition&gt;]
[ORDER BY &lt;column&gt; ASC|DESC]
[LIMIT &lt;n&gt; OFFSET &lt;n&gt;];</code></pre>
        </section>

        <section id="basic-examples">
            <h2>Basic Examples</h2>

            <h3>Select All Columns</h3>
            <p>Retrieve every row and column from a table:</p>
            <span class="code-label">Example</span>
            <pre><code>SELECT * FROM users;</code></pre>

            <h3>Select Specific Columns</h3>
            <p>Retrieve only specific fields to reduce data transfer:</p>
            <span class="code-label">Example</span>
            <pre><code>SELECT username, email, age FROM users;</code></pre>
        </section>

        <section id="filtering">
            <h2>Filtering (WHERE)</h2>
            <p>Use the <code>WHERE</code> clause to filter results. MaazDB supports standard comparison and logical operators.</p>

            <h3>Comparison Operators</h3>
            <pre><code>-- Numeric comparison
SELECT * FROM products WHERE price > 50.00;

-- String matching
SELECT * FROM users WHERE username = 'Alice';

-- Boolean check
SELECT * FROM tasks WHERE completed = TRUE;</code></pre>

            <h3>Logical Operators (AND / OR)</h3>
            <pre><code>-- Both conditions must be true
SELECT * FROM users WHERE age > 21 AND active = TRUE;

-- Either condition can be true
SELECT * FROM users WHERE role = 'admin' OR role = 'moderator';</code></pre>

            <h3>Complex Grouping</h3>
            <p>Use parentheses to control operator precedence:</p>
            <pre><code>SELECT * FROM orders 
WHERE (status = 'pending' AND total > 100) 
   OR (status = 'urgent');</code></pre>

            <h3>NULL Checks</h3>
            <pre><code>-- Find rows with missing values
SELECT * FROM users WHERE phone_number IS NULL;

-- Find rows with values present
SELECT * FROM users WHERE email IS NOT NULL;</code></pre>
        </section>

        <section id="sorting">
            <h2>Sorting & Pagination</h2>

            <h3>ORDER BY</h3>
            <p>Sort results by a specific column. Default is <code>ASC</code> (Ascending).</p>
            <span class="code-label">Example</span>
            <pre><code>-- Sort by age (Ascending)
SELECT * FROM users ORDER BY age;

-- Sort by price (Descending)
SELECT * FROM products ORDER BY price DESC;</code></pre>

            <h3>LIMIT and OFFSET</h3>
            <p>Essential for implementing pagination in applications.</p>
            <span class="code-label">Example</span>
            <pre><code>-- Get the first 10 rows
SELECT * FROM users LIMIT 10;

-- Get the next 10 rows (Skip 10, take 10)
SELECT * FROM users LIMIT 10 OFFSET 10;</code></pre>
        </section>

        <section id="optimization">
            <h2>Performance Optimization</h2>
            
            <div class="info-box">
                <strong>ðŸš€ O(1) Lookup:</strong> MaazDB automatically detects queries filtering by the <strong>Primary Key</strong> and switches to a direct index lookup instead of a table scan.
            </div>

            <h3>Optimized Query</h3>
            <p>This query runs in constant time regardless of table size:</p>
            <pre><code>SELECT * FROM users WHERE id = 54321;</code></pre>

            <h3>Standard Scan</h3>
            <p>This query requires scanning rows (O(n)) to find matches:</p>
            <pre><code>SELECT * FROM users WHERE email = 'john@example.com';</code></pre>
        </section>

        <section id="aggregates">
            <h2>Aggregates & Expressions</h2>
            <p>Aggregates perform calculations on a set of values and return a single result.</p>

            <h3>Counting Rows</h3>
            <p>Count the total number of rows matching a condition:</p>
            <pre><code>SELECT COUNT(*) FROM users WHERE active = TRUE;</code></pre>

            <h3>Math Aggregates</h3>
            <p>Calculate the sum, maximum, or minimum values of a column:</p>
            <pre><code>SELECT SUM(salary) FROM employees;
SELECT MAX(score) FROM players;
SELECT MIN(price) FROM products;</code></pre>

            <h3>Evaluating Expressions</h3>
            <p>MaazDB can evaluate mathematical and logical expressions directly:</p>
            <pre><code>SELECT 10 * 5, 'Hello' + ' World', TRUE AND FALSE;</code></pre>
        </section>

        <section id="comparison">
            <h2>DML Comparison</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Purpose</th>
                        <th>Complexity</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>SELECT (PK)</strong></td>
                        <td>Read by ID</td>
                        <td><strong>O(1)</strong></td>
                    </tr>
                    <tr>
                        <td><strong>SELECT (Scan)</strong></td>
                        <td>Read by Filter</td>
                        <td>O(n)</td>
                    </tr>
                    <tr>
                        <td><strong>INSERT</strong></td>
                        <td>Create</td>
                        <td>O(1)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Bottom Navigation -->
        <div style="display: flex; justify-content: space-between; margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border);">
            <a href="{{ url_for('main.insert') }}" class="btn-nav" style="background: var(--bg-card); color: var(--text-main) !important; border: 1px solid var(--border); box-shadow: none;">&larr; Prev: INSERT</a>
            <a href="{{ url_for('main.update') }}" class="btn-nav">Next: UPDATE &rarr;</a>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Copy to Clipboard
    const copyButtons = document.querySelectorAll('pre');
    
    copyButtons.forEach(pre => {
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.innerHTML = '<i class="far fa-copy"></i> Copy';
        pre.style.position = 'relative';
        pre.appendChild(button);
        
        button.addEventListener('click', async () => {
            const code = pre.querySelector('code').innerText;
            
            try {
                await navigator.clipboard.writeText(code);
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                
                setTimeout(() => {
                    button.innerHTML = '<i class="far fa-copy"></i> Copy';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        });
    });

    // Syntax Highlighting
    const keywords = ['SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'NOT', 'IS', 'NULL', 'ORDER', 'BY', 'ASC', 'DESC', 'LIMIT', 'OFFSET', 'COUNT', 'MAX', 'MIN', 'SUM', 'TRUE', 'FALSE'];
    const codeBlocks = document.querySelectorAll('pre code');
    
    codeBlocks.forEach(block => {
        let html = block.innerHTML;
        const keywordRegex = new RegExp(`\\b(${keywords.join('|')})\\b`, 'gi');
        html = html.replace(keywordRegex, '<span class="sql-keyword">$1</span>');
        block.innerHTML = html;
    });

    // Scroll Spy
    const sidebarLinks = document.querySelectorAll('.docs-sidebar a');
    const sections = document.querySelectorAll('section[id]');
    
    window.addEventListener('scroll', () => {
        let current = '';
        const scrollY = window.pageYOffset + 100;
        
        sections.forEach(section => {
            if (scrollY >= section.offsetTop && scrollY < section.offsetTop + section.clientHeight) {
                current = section.getAttribute('id');
            }
        });
        
        sidebarLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    });
});
</script>
{% endblock %}