{% extends "base.html" %}

{% block head %}
<!-- Load the documentation CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/other.css') }}">
{% endblock %}

{% block content %}
<div class="docs-layout">
    
    <!-- SIDEBAR -->
    <aside class="docs-sidebar">
        <h3>UPDATE Guide</h3>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#syntax">Syntax</a></li>
            <li><a href="#examples">Examples</a></li>
            <li><a href="#data-types">Data Types</a></li>
            <li><a href="#where-clause">WHERE Clause</a></li>
            <li><a href="#best-practices">Best Practices</a></li>
            <li><a href="#comparison">DML Comparison</a></li>
        </ul>

        <h3>Related Commands</h3>
        <ul>
            <li><a href="{{ url_for('main.select') }}">SELECT</a></li>
            <li><a href="{{ url_for('main.insert') }}">INSERT</a></li>
            <li><a href="{{ url_for('main.delete') }}">DELETE</a></li>
        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="docs-content">
        <h1>UPDATE Command</h1>
        <p><strong>Data Manipulation Language (DML)</strong> — Modify existing rows in a table based on conditions.</p>

        <section id="overview">
            <h2>Overview</h2>
            <p>The <code>UPDATE</code> command modifies one or more existing rows in a table. It allows you to change values in specific columns for rows that match your criteria.</p>
            
            <div class="warning-box">
                <strong>⚠️ Warning:</strong> Always use a <code>WHERE</code> clause unless you intentionally want to update <strong>every row</strong> in the table. Updates cannot be undone without a backup.
            </div>
        </section>

        <section id="syntax">
            <h2>Syntax</h2>
            <span class="code-label">Basic Syntax</span>
            <pre><code>UPDATE &lt;table_name&gt; 
SET &lt;column&gt; = &lt;value&gt; [, &lt;column&gt; = &lt;value&gt;] 
WHERE &lt;condition&gt;;</code></pre>
        </section>

        <section id="examples">
            <h2>Examples</h2>

            <h3>Simple Update (Single Column)</h3>
            <p>Update the salary of a specific user:</p>
            <span class="code-label">Example</span>
            <pre><code>UPDATE users SET salary = 55000.00 WHERE name = 'Alice';</code></pre>

            <h3>Update Multiple Columns</h3>
            <p>Change multiple fields at once using a comma separator:</p>
            <span class="code-label">Example</span>
            <pre><code>UPDATE employees 
SET salary = 65000.00, role = 'Senior Engineer' 
WHERE id = 5;</code></pre>

            <h3>Conditional Update</h3>
            <p>Deactivate inactive employees and reset their salary:</p>
            <span class="code-label">Example</span>
            <pre><code>UPDATE employees 
SET active = FALSE, salary = 0 
WHERE age > 65 AND role = 'Intern';</code></pre>

            <h3>Fast Update (O(1) Lookup)</h3>
            <p>When filtering by Primary Key, MaazDB optimizes the operation:</p>
            <span class="code-label">Optimized</span>
            <pre><code>UPDATE users SET active = TRUE WHERE id = 1;</code></pre>

            <h3>Update Timestamp</h3>
            <p>Update a timestamp field to mark modification time:</p>
            <span class="code-label">Example</span>
            <pre><code>UPDATE users 
SET last_updated = '2024-01-29 15:30:00' 
WHERE name = 'Bob';</code></pre>
        </section>

        <section id="data-types">
            <h2>Data Type Compatibility</h2>
            <p>Values must match the target column's data type:</p>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Example</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>INT</strong></td>
                        <td><code>42</code></td>
                        <td>Whole numbers</td>
                    </tr>
                    <tr>
                        <td><strong>DOUBLE</strong></td>
                        <td><code>99.99</code></td>
                        <td>Floating-point</td>
                    </tr>
                    <tr>
                        <td><strong>TEXT</strong></td>
                        <td><code>'Hello'</code></td>
                        <td>Single/Double quotes</td>
                    </tr>
                    <tr>
                        <td><strong>BOOL</strong></td>
                        <td><code>TRUE</code></td>
                        <td>Case-insensitive</td>
                    </tr>
                    <tr>
                        <td><strong>TIMESTAMP</strong></td>
                        <td><code>'2024-01-01 12:00:00'</code></td>
                        <td>Exact format required</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="where-clause">
            <h2>WHERE Clause Operators</h2>
            
            <h3>Comparison</h3>
            <p>Standard operators: <code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code></p>
            <pre><code>UPDATE products SET price = 10.00 WHERE price < 5.00;</code></pre>

            <h3>Logical</h3>
            <p>Combine conditions: <code>AND</code>, <code>OR</code>, <code>NOT</code></p>
            <pre><code>UPDATE users SET role = 'admin' WHERE age > 30 AND active = TRUE;</code></pre>

            <h3>Null Checks</h3>
            <p>Check for existence: <code>IS NULL</code>, <code>IS NOT NULL</code></p>
            <pre><code>UPDATE users SET status = 'unknown' WHERE phone IS NULL;</code></pre>
        </section>

        <section id="best-practices">
            <h2>Best Practices</h2>

            <h3>1. Test Before Update</h3>
            <p>Run a <code>SELECT</code> query with the same <code>WHERE</code> clause to verify which rows will be affected.</p>
            <pre><code>-- Check first
SELECT * FROM users WHERE age > 65;

-- Then update
UPDATE users SET status = 'retired' WHERE age > 65;</code></pre>

            <h3>2. Create Backups</h3>
            <p>Before bulk updates, create a snapshot.</p>
            <pre><code>BACKUP 'pre_update_snapshot';
UPDATE users SET salary = salary + 1000;</code></pre>

            <h3>3. Respect Foreign Keys</h3>
            <p>Updating a column referenced by a foreign key may fail if the new value doesn't exist in the parent table.</p>
        </section>

        <section id="comparison">
            <h2>DML Comparison</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Purpose</th>
                        <th>Risk Level</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>INSERT</strong></td>
                        <td>Add new rows</td>
                        <td>Low</td>
                    </tr>
                    <tr>
                        <td><strong>UPDATE</strong></td>
                        <td>Modify rows</td>
                        <td><strong>High</strong> (if WHERE omitted)</td>
                    </tr>
                    <tr>
                        <td><strong>DELETE</strong></td>
                        <td>Remove rows</td>
                        <td><strong>High</strong> (Data loss)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Bottom Navigation -->
        <div style="display: flex; justify-content: space-between; margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border);">
            <a href="{{ url_for('main.select') }}" class="btn-nav" style="background: var(--bg-card); color: var(--text-main) !important; border: 1px solid var(--border); box-shadow: none;">&larr; Prev: SELECT</a>
            <a href="{{ url_for('main.delete') }}" class="btn-nav">Next: DELETE &rarr;</a>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Copy to Clipboard
    const copyButtons = document.querySelectorAll('pre');
    
    copyButtons.forEach(pre => {
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.innerHTML = '<i class="far fa-copy"></i> Copy';
        pre.style.position = 'relative';
        pre.appendChild(button);
        
        button.addEventListener('click', async () => {
            const code = pre.querySelector('code').innerText;
            
            try {
                await navigator.clipboard.writeText(code);
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                
                setTimeout(() => {
                    button.innerHTML = '<i class="far fa-copy"></i> Copy';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        });
    });

    // Syntax Highlighting
    const keywords = ['UPDATE', 'SET', 'WHERE', 'AND', 'OR', 'NOT', 'IS', 'NULL', 'TRUE', 'FALSE', 'SELECT', 'BACKUP', 'INSERT', 'DELETE'];
    const codeBlocks = document.querySelectorAll('pre code');
    
    codeBlocks.forEach(block => {
        let html = block.innerHTML;
        const keywordRegex = new RegExp(`\\b(${keywords.join('|')})\\b`, 'gi');
        html = html.replace(keywordRegex, '<span class="sql-keyword">$1</span>');
        block.innerHTML = html;
    });

    // Scroll Spy
    const sidebarLinks = document.querySelectorAll('.docs-sidebar a');
    const sections = document.querySelectorAll('section[id]');
    
    window.addEventListener('scroll', () => {
        let current = '';
        const scrollY = window.pageYOffset + 100;
        
        sections.forEach(section => {
            if (scrollY >= section.offsetTop && scrollY < section.offsetTop + section.clientHeight) {
                current = section.getAttribute('id');
            }
        });
        
        sidebarLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    });
});
</script>
{% endblock %}