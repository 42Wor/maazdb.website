{% extends "base.html" %}

{% block head %}
 {% endblock %}

{% block content %}
<div class="docs-layout">
    
    <!-- SIDEBAR NAVIGATION -->
    <aside class="docs-sidebar">
        <h3>General</h3>
        <ul>
            <li><a href="#protocol" class="active">Protocol</a></li>
            <li><a href="#auth">Authentication</a></li>
            <li><a href="#db-mgmt">Database Mgmt</a></li>
        </ul>

        <h3>Schema (DDL)</h3>
        <ul>
            <li><a href="#types">Data Types</a></li>
            <li><a href="#create-table">Create Table</a></li>
            <li><a href="#foreign-keys">Foreign Keys</a></li>
            <li><a href="#drop-table">Drop Table</a></li>
        </ul>

        <h3>Data (DML)</h3>
        <ul>
            <li><a href="#insert">Insert</a></li>
            <li><a href="#update">Update</a></li>
            <li><a href="#delete">Delete</a></li>
            <li><a href="#select">Select</a></li>
        </ul>

        <h3>System</h3>
        <ul>
            <li><a href="#backup">Backup & Restore</a></li>
        </ul>
        <h3>Test Suite</h3>
        <ul>
            <li><a href="#test-suite" >Complete Example</a></li>
            <li><a href="#tab1" class="tab-link" onclick="event.preventDefault(); showTab('tab1', event);">Full Test SQL</a></li>
            <li><a href="#tab2" class="tab-link" onclick="event.preventDefault(); showTab('tab2', event);">File Test SQL</a></li>
        </ul>
    </aside>

    <!-- MAIN DOCUMENTATION CONTENT -->
    <main class="docs-content">

        <section id="intro">
            <h1>MaazDB Documentation</h1>
            <p><strong>Version:</strong> {{ version }}<br>
            <strong>Default Port:</strong> 8888<br>
            <strong>Protocol:</strong> TCP / Binary Length-Prefixed</p>
            <hr class="docs-divider">
        </section>

        <!-- 1. PROTOCOL -->
        <section id="protocol">
            <h2>1. Connection Protocol</h2>
            <p>MaazDB uses a custom binary protocol. Every packet follows this structure:</p>
            <table>
                <thead><tr><th>Byte</th><th>Field</th><th>Description</th></tr></thead>
                <tbody>
                    <tr><td>1</td><td>Type</td><td><code>0x01</code> Command, <code>0x02</code> Msg, <code>0x03</code> Data, <code>0xFF</code> Error</td></tr>
                    <tr><td>4</td><td>Length</td><td>Unsigned 32-bit Integer (Big-Endian)</td></tr>
                    <tr><td>N</td><td>Payload</td><td>UTF-8 String (SQL or JSON Result)</td></tr>
                </tbody>
            </table>
        </section>

        <!-- 2. AUTHENTICATION -->
        <section id="auth">
            <h2>2. Authentication</h2>
            
            <h3>Login</h3>
            <p>Authenticates the current session. Must be the first command sent.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>LOGIN &lt;username&gt; PASSWORD '&lt;password&gt;';</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>LOGIN admin PASSWORD 'admin';</code></pre>

            <h3>Create User</h3>
            <p>Registers a new user in the system.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>CREATE USER &lt;username&gt; PASSWORD '&lt;password&gt;';</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>CREATE USER john PASSWORD 'secret123';</code></pre>
        </section>

        <!-- 3. DATABASE MANAGEMENT -->
        <section id="db-mgmt">
            <h2>3. Database Management</h2>

            <h3>Create Database</h3>
            <span class="code-label">Syntax</span>
            <pre><code>CREATE DATABASE &lt;db_name&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>CREATE DATABASE shop_db;</code></pre>

            <h3>Use Database</h3>
            <p>Selects the active database for subsequent queries.</p>
            <span class="code-label">Syntax</span>
            <pre><code>USE &lt;db_name&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>USE shop_db;</code></pre>

            <h3>Drop Database</h3>
            <span class="code-label">Syntax</span>
            <pre><code>DROP DATABASE &lt;db_name&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>DROP DATABASE shop_db;</code></pre>
        </section>

        <!-- 4. SCHEMA (DDL) -->
        <section id="types">
            <h2>4. Schema Definition (DDL)</h2>
            <h3>Supported Data Types</h3>
            <table>
                <thead><tr><th>Type</th><th>Description</th></tr></thead>
                <tbody>
                    <tr><td><code>SERIAL</code></td><td>Auto-incrementing Integer (Primary Key only)</td></tr>
                    <tr><td><code>INT</code></td><td>Standard 32-bit Integer</td></tr>
                    <tr><td><code>DOUBLE</code></td><td>64-bit Floating point</td></tr>
                    <tr><td><code>TEXT</code></td><td>UTF-8 String</td></tr>
                    <tr><td><code>BOOL</code></td><td>Boolean (TRUE/FALSE)</td></tr>
                    <tr><td><code>TIMESTAMP</code></td><td>Format: 'YYYY-MM-DD HH:MM:SS'</td></tr>
                </tbody>
            </table>
        </section>

        <section id="create-table">
            <h3>Create Table</h3>
            <p>Defines a new table structure.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>CREATE TABLE &lt;table_name&gt; (
    &lt;col_name&gt; &lt;type&gt; [PRIMARY KEY],
    &lt;col_name&gt; &lt;type&gt;,
    ...
);</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    age INT,
    salary DOUBLE,
    active BOOL
);</code></pre>
        </section>

        <section id="foreign-keys">
            <h3>Foreign Keys</h3>
            <p>Enforces referential integrity between tables.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>CREATE TABLE &lt;table_name&gt; (
    ...
    FOREIGN KEY (&lt;local_col&gt;) REFERENCES &lt;parent_table&gt;(&lt;parent_col&gt;)
);</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT,
    amount DOUBLE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);</code></pre>
        </section>

        <section id="drop-table">
            <h3>Drop Table</h3>
            <span class="code-label">Syntax</span>
            <pre><code>DROP TABLE &lt;table_name&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>DROP TABLE users;</code></pre>
        </section>

        <!-- 5. DATA MANIPULATION (DML) -->
        <section id="insert">
            <h2>5. Data Manipulation (DML)</h2>
            
            <h3>Insert</h3>
            <p>Adds new rows. Do not include <code>SERIAL</code> columns.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>INSERT INTO &lt;table_name&gt; (&lt;col1&gt;, &lt;col2&gt;) VALUES (&lt;val1&gt;, &lt;val2&gt;);</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>INSERT INTO users (name, age, active) VALUES ('Alice', 30, TRUE);</code></pre>
        </section>

        <section id="update">
            <h3>Update</h3>
            <p>Modifies existing data based on a condition.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>UPDATE &lt;table_name&gt; SET &lt;col&gt; = &lt;val&gt; WHERE &lt;condition&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>UPDATE users SET salary = 55000.00 WHERE name = 'Alice';</code></pre>
        </section>

        <section id="delete">
            <h3>Delete</h3>
            <p>Removes rows based on a condition.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>DELETE FROM &lt;table_name&gt; WHERE &lt;condition&gt;;</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>DELETE FROM users WHERE name = 'Charlie';</code></pre>
        </section>

        <section id="select">
            <h3>Select</h3>
            <p>Retrieves data. Supports <code>WHERE</code>, <code>ORDER BY</code>, <code>LIMIT</code>, and <code>OFFSET</code>.</p>
            
            <span class="code-label">Syntax</span>
            <pre><code>SELECT &lt;cols&gt; FROM &lt;table_name&gt; [WHERE condition] [ORDER BY col] [LIMIT n];</code></pre>
            
            <span class="code-label">Example 1 (Basic)</span>
            <pre><code>SELECT * FROM users WHERE age > 25;</code></pre>
            
            <span class="code-label">Example 2 (Complex)</span>
            <pre><code>SELECT name, salary FROM users 
WHERE active = TRUE 
ORDER BY salary DESC 
LIMIT 10;</code></pre>
        </section>

        <!-- 6. BACKUP & RESTORE -->
        <section id="backup">
            <h2>6. Disaster Recovery</h2>
            
            <h3>Backup</h3>
            <p>Creates a snapshot of the current database state.</p>
            <span class="code-label">Syntax</span>
            <pre><code>BACKUP '&lt;snapshot_name&gt;';</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>BACKUP 'snapshot_v1';</code></pre>

            <h3>Restore</h3>
            <p>Reverts database to a snapshot. <strong>Overwrites current data.</strong></p>
            <span class="code-label">Syntax</span>
            <pre><code>RESTORE '&lt;snapshot_name&gt;';</code></pre>
            
            <span class="code-label">Example</span>
            <pre><code>RESTORE 'snapshot_v1';</code></pre>
        </section>
                    <section id="test-suite">
                        <h2>Complete Test Suite Example</h2>
                        <p>Below is a comprehensive test suite demonstrating all major features of MaazDB v11.9:</p>
                        
                        <div class="code-tabs">
                            <button class="tab active" data-tab="tab1" type="button" onclick="showTab('tab1', event)">Full Test SQL</button>
                            <button class="tab" data-tab="tab2" type="button" onclick="showTab('tab2', event)">File Test SQL</button>
                        </div>

                        <div id="tab1" class="tab-content active">
                            <pre><code>-- MaazDB v11.9 Comprehensive Test Suite
                    -- Demonstrates all major features

                    -- 1. Authentication
                    LOGIN admin PASSWORD 'admin';

                    -- 2. Database Management
                    CREATE DATABASE full_test_db;
                    USE full_test_db;

                    -- 3. DDL with Foreign Keys
                    CREATE TABLE employees (
                        id SERIAL PRIMARY KEY,
                        name TEXT,
                        role TEXT,
                        salary DOUBLE,
                        is_active BOOL,
                        joined_at TIMESTAMP
                    );

                    -- 4. INSERT with various data types
                    INSERT INTO employees (name, role, salary, is_active, joined_at) 
                    VALUES ('Alice', 'Engineer', 85000.00, TRUE, '2023-01-15 09:00:00');

                    INSERT INTO employees (name, role, salary, is_active, joined_at) 
                    VALUES ('Bob', 'Manager', 95000.50, TRUE, '2022-05-20 10:30:00');

                    INSERT INTO employees (name, role, salary, is_active, joined_at) 
                    VALUES ('Charlie', 'Intern', 30000.00, FALSE, '2024-01-10 08:15:00');

                    -- 5. SELECT queries
                    SELECT * FROM employees;
                    SELECT name, salary FROM employees WHERE salary > 50000;

                    -- 6. UPDATE operations
                    UPDATE employees SET salary = 90000.00 WHERE name = 'Alice';
                    SELECT name, salary FROM employees WHERE name = 'Alice';

                    -- 7. DELETE operations
                    DELETE FROM employees WHERE name = 'Charlie';
                    SELECT COUNT(*) FROM employees;

                    -- 8. Foreign Key relationships
                    CREATE TABLE projects (
                        pid SERIAL PRIMARY KEY,
                        title TEXT,
                        lead_id INT,
                        FOREIGN KEY (lead_id) REFERENCES employees(id)
                    );

                    INSERT INTO projects (title, lead_id) VALUES ('Project X', 1);
                    SELECT * FROM projects;

                    -- 9. Backup & Restore
                    BACKUP 'full_backup_test';
                    DROP TABLE projects;
                    DROP TABLE employees;
                    RESTORE 'full_backup_test';
                    SELECT COUNT(*) FROM employees;

                    -- 10. Cleanup
                    USE system;
                    DROP DATABASE full_test_db;</code></pre>
                        </div>

                        <div id="tab2" class="tab-content">
                            <pre><code>-- File System Test Suite
                    LOGIN admin PASSWORD 'admin';
                    CREATE DATABASE file_test_db;
                    USE file_test_db;

                    CREATE TABLE products (
                        id SERIAL PRIMARY KEY,
                        name TEXT,
                        price DOUBLE
                    );

                    INSERT INTO products (name, price) VALUES ('Laptop', 999.99);
                    INSERT INTO products (name, price) VALUES ('Mouse', 25.50);
                    INSERT INTO products (name, price) VALUES ('Keyboard', 45.00);

                    SELECT * FROM products;
                    UPDATE products SET price = 899.99 WHERE name = 'Laptop';
                    DELETE FROM products WHERE name = 'Mouse';

                    BACKUP 'file_test_backup';
                    SELECT COUNT(*) FROM products;

                    USE system;
                    DROP DATABASE file_test_db;</code></pre>
                        </div>
                    </section>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
    function showTab(tabId, event) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => {
            content.classList.remove('active');
        });
        
        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Show selected tab content and mark tab as active
        const selectedTab = document.getElementById(tabId);
        if (selectedTab) {
            selectedTab.classList.add('active');
        }
        
        // Mark the clicked tab as active
        event.target.classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 1. Syntax Highlighting Logic
        const codeBlocks = document.querySelectorAll('pre code');
        
        const keywords = ['LOGIN', 'CREATE', 'DATABASE', 'USE', 'TABLE', 'DROP', 'INSERT', 'INTO', 'VALUES', 'UPDATE', 'SET', 'WHERE', 'DELETE', 'FROM', 'SELECT', 'ORDER', 'BY', 'LIMIT', 'OFFSET', 'BACKUP', 'RESTORE', 'PRIMARY', 'KEY', 'FOREIGN', 'REFERENCES', 'SERIAL', 'INT', 'DOUBLE', 'TEXT', 'BOOL', 'TIMESTAMP', 'PASSWORD', 'USER', 'AND', 'OR', 'NOT'];
        
        codeBlocks.forEach(block => {
            let html = block.innerHTML;
            
            // Highlight Keywords
            keywords.forEach(kw => {
                const regex = new RegExp(`\\b${kw}\\b`, 'gi');
                html = html.replace(regex, `<span class="sql-keyword">${kw}</span>`);
            });
            
            // Highlight Strings
            html = html.replace(/'([^']+)'/g, `<span class="sql-string">'$1'</span>`);
            
            // Highlight Numbers
            html = html.replace(/\b(\d+)\b/g, `<span class="sql-number">$1</span>`);
            
            block.innerHTML = html;
        });

        // 2. Scroll Spy for Sidebar
        const sidebarLinks = document.querySelectorAll('.docs-sidebar a');
        const sections = document.querySelectorAll('section[id]');

        window.addEventListener('scroll', () => {
            let current = '';
            const scrollY = window.scrollY + 100; // Offset

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            sidebarLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
});

// 3. Copy to Clipboard functionality
const blocks = document.querySelectorAll('pre');
blocks.forEach(block => {
    const button = document.createElement('button');
    button.className = 'copy-btn';
    button.innerHTML = '<i class="far fa-copy"></i>';
    button.style.position = 'absolute';
    button.style.top = '10px';
    button.style.right = '10px';
    block.style.position = 'relative';
    block.appendChild(button);

    button.addEventListener('click', () => {
        const code = block.querySelector('code').innerText;
        navigator.clipboard.writeText(code).then(() => {
            button.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => {
                button.innerHTML = '<i class="far fa-copy"></i>';
            }, 2000);
        });
    });
});
});
</script>
{% endblock %}